# Hyperledger Fabric架构
原文：Architecture of the Hyperledger Blockchain Fabric  
作者：Christian Cachin  
IBM Research - Zurich CH-8803 R¨uschlikon, Switzerland  
翻译：Vayne Tian  
这篇文章是读完论文后翻译过来的，也算是给自己加深印象，有翻译的不好的地方多多见谅。  
原文地址：https://pdfs.semanticscholar.org/f852/c5f3fe649f8a17ded391df0796677a59927f.pdf

# 总览  
区块链可以被看作是状态机的复本。任何时间点对整个链进行快照，就可以将结果视为一种世界状态，而客户进行的操作——智能合约的调用的实质就是改变世界状态并产生一些输出。区块链通过分布式的网络节点，模拟了一种可信计算的服务系统。这个系统相当于或者产生了一笔资产，而所有的节点都持有它的股份。这些节点不需要信任对方，但有一个共同的目标，就是将这个服务持续运行下去。在一个没有准入机制的区块链里，比如加密货币比特币底层的架构，任何人都可以去操作一个节点，并且通过基于CPU运算（原文如此）的工作量证明参与其中。但从另一方面来说，如果一个区块链拥有准入机制，那么它就可以通过验证和协议来控制什么节点可以参与进来，这些节点通常拥有一致性并建立起联盟。

# Hyperledger
超级账本是一个致力于建立企业级的开源分布式账本框架和代码库的合作项目。它的目标是通过实现一个分布式账本的跨行业开放式标准来发展区块链技术，这将改变全世界商业交易的方式。2016年初，Linux基金会成立了HyperLedger项目，目前已经有超过50名成员。（200+，2018）

# Hyperledger Fabric
HyperLedger Fabric是一种分布式账本平台的实现，它利用成熟的经过验证的技术和模块化的架构，来运行智能合约并允许实现各式可插拔的函数。它是 HyperLedger多个同时孵化中的子项目之一。2016年6月，Hyperledger Fabric v0.5开发版公布。（v1.1为现在的开发版 2018）

HyperLedger Fabric的分布式账本协议是在peers上运行的。Fabric区分两种peer，一种是validating peer，作为网络上负责运行共识，验证交易和维持账本。另一种non-validating peer的作用则是作为代理服务器，连接其他的客户到validating peer，本质上就是发布交易。一个non-validating peer可能只是验证交易而并不会去执行交易。
	
# Fabric v0.5的一些主要特性

1.拥有准入机制的区块链，交易发生后在极短时间内达成共识并产生最终结果  
2.可以运行任意的智能合约（这里叫做chaincode 链码） 使用go语言实现  
用户定义的链码被封装在docker容器中，系统级的链码则会同样以peer的形式运行  
3.可插拔共识算法，使用实用拜占庭同错算法（PBFT），可用SIEVE的原型来部署非确定性链码，对于单peer可以使用NOOPS（一种协议存根）作为开发服务  
4.通过证书颁发机构（CAs）发布TLS证书，注册证书和交易证书来保证安全性  
5.利用RocksDb支持键值对存储接口实现持久状态  
6.拥有支持预定义和自定义事件的框架  
7.拥有nodejs接口实现的客户端SDK  
8.支持REST APIs和CLIs  
在v0.5-dev版本中，只实现了最低限度对non-validating peer的支持。  


# HyperLedger Fabric架构
	
这些validating peers将会通过拜占庭容错的共识算法运行一个状态机副本来接收三种交易信息  

部署交易：将一个用go语言编写的链码（智能合约）当作参数，链码将会在peers上安装并准备执行。  

执行交易：调用一段早先被部署在peers上的链码执行交易。参数与具体调用的链码类型有关。链码执行交易，将会在世界状态上进行读写，并指出这个交易是否成功。 

查询交易：通过直接读取peer的状态返回一些条目，这个操作不会保证线性一致性。  

每个链码可以定义在世界状态中自己的固有条目。区块链上的哈希链是基于已经执行的交易以及交易产生的状态计算出来的。  

交易只有在重复执行链码并保证满足拜占庭容错的假设时才有效，举例来说，n个validating peer中有最多f<(1/3)*n个节点可能撒谎并产生任意行为，但其他的peer一定会正确运行。当在使用拜占庭容错算法上运行时，链码必须保证其确定性，否则peers的状态可能会产生分叉。一个可以分离出可能会导致分叉的非确定性交易的解决方案已经被证实，并且在实现在SIEVE协议中。 

Validating peers之间通过拜占庭容错算法建立的关系是静态的，并且在初始化阶段需要人为干预。对于动态变更节点的共识算法的支持将在未来版本中发布。  

由于HyperLedger Fabric实现了拥有准入机制的账本，它得以包含了可以认证和授权的安全架构。支持通过公钥认证来注册和授权交易，通过带内加密保证链码的保密性。

更准确地说，为了连接到网络，每个peer需要通过成员服务中的注册证书颁发机构（CA）获取注册认证。它允许这个peer连接到网络并获取在交易时所需要的交易证书。交易证书颁发机构会发布交易证书并且支持对那些提交交易的节点进行匿名认证，从这个意义上讲，多个发布给同一个peer的交易证书（对于注册证书而言也是一样）不会互相产生联系。  

对于所有拥有注册证书的peer，链码和状态的保密性是通过使用区块链专有的密钥对交易和状态进行对称加密实现的。在将来的版本中，将会扩展加密功能来为交易和状态提供更好的保密性。  


# 对HyperLedger Fabric的一些讨论
当前对于区块链的共识算法有非常激烈的争论，不仅仅是在学术界，对于一些金融科技的创业公司也是一样。例如tendermint，kadena。Fabric的设计使用了模块化的概念，对准了已经成熟的分布式计算中的共识系统。这将保证Fabric的区块链相关的特性将会独立地在不同的共识算法上发展，实用拜占庭容错（PBFT）由于它的知名，成为了在Fabric上首个实现的共识算法，这是在20年来对于系统级别的拜占庭容错研究经验上发展而来的，它和一些知名的共识算法有紧密的联系，比如Poxos和Viewstamped replication，这些算法都已经在许多环境中被实现或是写进了教科书中。

# 小结

与极客推崇的完全去中心化的系统不同，HyperLedger Fabric是拥有准入机制的多中心化的基于商业用途的区块链平台。它开源，依据规范，并能运行用户定义的智能合约。它拥有很强的安全性以及身份特征，并且使用了模块化的框架与可插拔的分布式共识。  
在Hyperledger项目的管理下，Fabric正在飞速进化和发展。  
